<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insect Swarm Simulation</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
  <script>
    let insects = [];
    let numInsects = 150; // Number of insects

    function setup() {
      createCanvas(800, 600);
      for (let i = 0; i < numInsects; i++) {
        insects.push(new Insect(random(width), random(height)));
      }
    }

    function draw() {
      background(51);
      // Update and show each insect
      for (let i = 0; i < insects.length; i++) {
        insects[i].edges();
        insects[i].update();
        insects[i].show();
      }
    }

    class Insect {
      constructor(x, y) {
        this.position = createVector(x, y);
        this.velocity = createVector(random(-2, 2), random(-2, 2));
        this.acceleration = createVector();
        this.maxSpeed = 4;
        this.maxForce = 0.1;
        this.size = 6;
        this.color = color(random(255), random(255), random(255));
      }

      update() {
        // Move with erratic behavior to simulate quick adjustments
        this.flock(insects);
        this.velocity.add(this.acceleration);
        this.velocity.limit(this.maxSpeed);
        this.position.add(this.velocity);
        this.acceleration.mult(0);
      }

      applyForce(force) {
        this.acceleration.add(force);
      }

      edges() {
        if (this.position.x > width) {
          this.position.x = 0;
        } else if (this.position.x < 0) {
          this.position.x = width;
        }
        if (this.position.y > height) {
          this.position.y = 0;
        } else if (this.position.y < 0) {
          this.position.y = height;
        }
      }

      flock(insects) {
        let alignment = this.align(insects);
        let cohesion = this.cohere(insects);
        let separation = this.separate(insects);

        alignment.mult(1.0);
        cohesion.mult(1.0);
        separation.mult(2.0);

        this.applyForce(alignment);
        this.applyForce(cohesion);
        this.applyForce(separation);
      }

      align(insects) {
        let perceptionRadius = 50;
        let steering = createVector();
        let total = 0;
        for (let i = 0; i < insects.length; i++) {
          let d = p5.Vector.dist(this.position, insects[i].position);
          if (d < perceptionRadius && insects[i] !== this) {
            steering.add(insects[i].velocity);
            total++;
          }
        }
        if (total > 0) {
          steering.div(total);
          steering.setMag(this.maxSpeed);
          steering.sub(this.velocity);
          steering.limit(this.maxForce);
        }
        return steering;
      }

      cohere(insects) {
        let perceptionRadius = 100;
        let steering = createVector();
        let total = 0;
        for (let i = 0; i < insects.length; i++) {
          let d = p5.Vector.dist(this.position, insects[i].position);
          if (d < perceptionRadius && insects[i] !== this) {
            steering.add(insects[i].position);
            total++;
          }
        }
        if (total > 0) {
          steering.div(total);
          steering.sub(this.position);
          steering.setMag(this.maxSpeed);
          steering.sub(this.velocity);
          steering.limit(this.maxForce);
        }
        return steering;
      }

      separate(insects) {
        let perceptionRadius = 25;
        let steering = createVector();
        let total = 0;
        for (let i = 0; i < insects.length; i++) {
          let d = p5.Vector.dist(this.position, insects[i].position);
          if (d < perceptionRadius && insects[i] !== this) {
            let diff = p5.Vector.sub(this.position, insects[i].position);
            diff.div(d);
            steering.add(diff);
            total++;
          }
        }
        if (total > 0) {
          steering.div(total);
        }
        if (steering.mag() > 0) {
          steering.setMag(this.maxSpeed);
          steering.sub(this.velocity);
          steering.limit(this.maxForce);
        }
        return steering;
      }

      randomMovement() {
        if (random() < 0.01) {
          let randForce = createVector(random(-1, 1), random(-1, 1));
          this.applyForce(randForce);
        }
      }

      show() {
        fill(this.color);
        noStroke();
        ellipse(this.position.x, this.position.y, this.size, this.size);
      }
    }
  </script>
</body>
</html>
